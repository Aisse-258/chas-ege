var n,nas=200,zelen={r:0,g:nas,b:0},krasn={r:nas,g:0,b:0},zhelt={r:nas,g:nas,b:0},flProv=1,vremyaStart;
function sozdGalki(){for(var a="",b="",c="",e="",d=1;d<=nabor.nZad;d++)if(!nabor.vykl[d]){var f="";window.comment="";try{nabor.upak[dvig.getzadname(d)].main(),f=' title="'+window.comment+'"'}catch(g){}a+="<td"+f+'><input type="checkbox" checked id="cB'+d+'" data-jstorage-id="sluch-cB'+d+"-"+nabor.name+'" /><label for="cB'+d+'" >'+dvig.getzadname(d)+" </label></td>";b+="<td"+f+'><span id="pB'+d+'"></span></td>';c+="<td"+f+'><span class="kolvoprav" id="pravB'+d+'"></span><br/>из<br/><span id="vsegB'+
d+'"></span></td>';e+="<td"+f+'><span class="vremya" id="vremyaB'+d+'"></span></td>'}$("#galki").html("<tr>"+a+'<td></td></tr><tr class="praviln">'+b+'<td><span id="pB"></span></td></tr><tr class="praviln">'+c+'<td><span class="kolvoprav" id="pravB"></span><br/>из<br/><span id="vsegB"></span></td></tr><td></td></tr><tr class="vremya">'+e)}
function veroyatn(){for(var a,b=1;b<=nabor.nZad;b++)a=umka.verno[b]/umka.vsego[b],$("#pB"+b).html(4<umka.vsego[b]?(100*a).toFixedLess(0)+"%":""),$("#pravB"+b).html(umka.verno[b]),$("#vsegB"+b).html(umka.vsego[b]),umka.kvoNaVremya[b]&&$("#vremyaB"+b).html((umka.vremya[b]/umka.kvoNaVremya[b]).round().toDvoet()),$("#pB"+b).css("color",0.5<a?cvetMezhdu(zhelt,zelen,2*a-1):cvetMezhdu(krasn,zhelt,2*a));a=umka.verno.sum()/umka.vsego.sum();$("#pB").html(4<umka.vsego.sum()?(100*(umka.verno.sum()/umka.vsego.sum())).toFixedLess(0)+
"%":"");$("#pravB").html(umka.verno.sum());$("#vsegB").html(umka.vsego.sum());$("#pB").css("color",0.5<a?cvetMezhdu(zhelt,zelen,2*a-1):cvetMezhdu(krasn,zhelt,2*a))}var slvopr;function obnov(a){slvopr=a;$("#pole").html(slvopr.txt);slvopr.trd();MathJax.Hub.Typeset();$("#otvet").html(slvopr.ver.join(";;"));$("#never").html(slvopr.nev.join(";;"));vremyaStart=(new Date).getTime()}
function vybrZad(){for(var a=1;a<=nabor.nZad;a++)v[a]=$("#cB"+a).is(":checked")?1:0;for(var b=[],a=1;a<=nabor.nZad;a++)v[a]&&b.push(a);if(b.length){if($("#radio-sluch").prop("checked"))return b.iz();if($("#radio-porad").prop("checked")){for(var c=n?n:0,a=0;b[a]<=c;a++);return b[a]?b[a]:b[0]}if($("#radio-umka").prop("checked")){b=[];for(a=1;a<=nabor.nZad;a++)if(v[a]&&5>umka.vsego[a])return a;for(a=1;a<=nabor.nZad;a++)v[a]?b.push(1.1-umka.verno[a]/umka.vsego[a]):b.push(0);return b.sVeroyatn()+1}return b.iz()}$("#pole").html('Хотя бы один тип заданий должен быть выбран! <button onclick="vybrv();">Выбрать все</button>')}
function sozdat(){strelkaEst=0;n=vybrZad();void 0!=n&&(dvig.zadan(obnov,n),zdnSost())}function podobnoe(){dvig.zadan(obnov,n,nomer);zdnSost()}
function zdnSost(){vazhnOn();checkJQuery("sozdat()","pole")&&checkMathJax("sozdat()","pole")&&($("#pole").html("Задание составляется, подождите..."),$("#protv").hide(),$("#otv").val(""),$("#prov").unbind("click"),$("#prov").bind("click",prover),$("#prov").show(),$("#sozd").hide(),$("#podob").hide(),setVKI(),VKI_attach(document.getElementById("otv")),flProv=0,$("#bnomer").show().html(dvig.getzadname(n)))}
function prover(){vazhnOff();var a=0,b=$("#otv").val();if(""===b){if(!confirm('Вы не ввели ответ, нажмите "Отмена" для того, чтобы ввести ответ или "ОК", чтобы сдаться и посмотреть ответ.'))return;uchetPrav(n,"N");a=1}$("#protv").show();var c=$("#check-praviln").is(":checked");c&&umka.vsego[n]++;var e="";slvopr.vrn(b)?(c&&umka.verno[n]++,e="Правильно!",uchetPrav(n,1)):(e="Неправильно! Правильный ответ: "+slvopr.ver.join(" или "),a||uchetPrav(n,0));$("#check-na-vremya").is(":checked")&&(umka.vremya[n]+=
((new Date).getTime()-vremyaStart)/1E3,umka.kvoNaVremya[n]++);vopr.rsh&&(e+="<br/><br/>"+vopr.rsh);$("#protv").html(e);MathJax.Hub.Typeset();$("#prov").hide();$("#sozd").show();$("#podob").show();sohrUmka();veroyatn();specCounter("sluch");flProv=1}function uchetPrav(a,b){if(!svinta){var c=document.createElement("iframe");c.src="../sh/sluchcounter.html?"+nabor.name+"/"+a+"#"+b;c.style.display="none";c.style.top="-9999px";c.style.position="absolute";document.body.appendChild(c)}}var v=[];
function vybrv(){for(var a=1;a<=nabor.nZad;a++)$("#cB"+a).not(":checked").click()}function obrabNaVremya(){$("#check-na-vremya").is(":checked")?$(".vremya").show():$(".vremya").hide()}function obrabPraviln(){$("#check-praviln").is(":checked")?$(".praviln").show():$(".praviln").hide()}function vybr0(){for(var a=1;a<=nabor.nZad;a++)$("#cB"+a).removeAttr("checked")}var strelkaEst=1;
function strelkaDvig(){strelkaEst?($("#strelka").animate({left:"-=20"},{duration:1E3}),$("#strelka").animate({left:"+=20"},{duration:1E3,complete:strelkaDvig}),$("#sozd").animate({opacity:"0.5"},{duration:1E3}),$("#sozd").animate({opacity:"1"},{duration:1E3})):$("#strelka").remove()}
function startShell(){sozdGalki();zagrUmka();veroyatn();$(obrabNaVremya);$(obrabPraviln);strelkaDvig();$("#prov").hide();$("#podob").hide();galkiKat("#galki_kat","sluch");spoiler();$("#otv").keyup(function(a){if(nabor.mnogostrOtvet||flProv)return!0;if(13==a.keyCode)return prover(),!1});assertCheckability()};
